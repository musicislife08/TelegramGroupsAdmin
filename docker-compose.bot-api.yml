# Docker Compose configuration for self-hosted Telegram Bot API server
#
# Purpose: Enable unlimited file downloads (up to 2GB) by running your own Bot API server
# Standard api.telegram.org limits file downloads to 20MB
#
# Usage:
#   1. Get API credentials from https://my.telegram.org/apps
#   2. Update TELEGRAM_API_ID and TELEGRAM_API_HASH below
#   3. Run: docker-compose -f docker-compose.bot-api.yml up -d
#   4. Configure Bot API Server URL in Settings → Telegram → Bot Configuration:
#      http://telegram-bot-api:8081 (if running on same Docker network)
#      http://localhost:8081 (if running standalone)
#
# IMPORTANT: The --local flag is REQUIRED for unlimited file downloads
# Without it, the 20MB limit still applies even with a self-hosted server

services:
  telegram-bot-api:
    image: aiogram/telegram-bot-api:latest
    container_name: telegram-bot-api
    environment:
      # Get these from https://my.telegram.org/apps
      - TELEGRAM_API_ID=YOUR_API_ID_HERE
      - TELEGRAM_API_HASH=YOUR_API_HASH_HERE

      # Optional: Logging level (0-5, default: 2)
      # - TELEGRAM_LOG_VERBOSITY=2

      # Optional: Stats tracking
      # - TELEGRAM_STAT=1

    volumes:
      # Persistent storage for downloaded files
      - telegram-bot-api-data:/var/lib/telegram-bot-api

    ports:
      # Bot API server port
      - "8081:8081"

    restart: unless-stopped

    # CRITICAL: --local flag enables unlimited file downloads
    # Without this flag, 20MB limit still applies
    command: --local

    # Optional: Resource limits for homelab deployment
    # deploy:
    #   resources:
    #     limits:
    #       memory: 512M
    #       cpus: '0.5'
    #     reservations:
    #       memory: 256M
    #       cpus: '0.25'

volumes:
  telegram-bot-api-data:
    driver: local

# Network configuration
# If running alongside TelegramGroupsAdmin, use the same network:
# networks:
#   default:
#     name: telegramgroupsadmin_default
#     external: true
