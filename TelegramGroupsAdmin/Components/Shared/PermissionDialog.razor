@using Microsoft.AspNetCore.Components
@using TelegramGroupsAdmin.Core.Models

<MudDialog>
    <DialogContent>
        <MudText Class="mb-4">Change permission level for @UserEmail</MudText>

        <MudRadioGroup @bind-Value="_selectedLevel">
            <MudRadio Value="PermissionLevel.Admin" Color="Color.Default">
                <MudStack Spacing="0">
                    <MudText Typo="Typo.body1">Admin</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Chat-scoped moderation - Can view/moderate only chats they're Telegram admin in</MudText>
                </MudStack>
            </MudRadio>
            <MudRadio Value="PermissionLevel.GlobalAdmin" Color="Color.Primary" Class="mt-2">
                <MudStack Spacing="0">
                    <MudText Typo="Typo.body1">GlobalAdmin</MudText>
                    <MudText Typo="Typo.caption" Color="Color.Secondary">Global moderation - Can view/moderate all chats, edit content settings</MudText>
                </MudStack>
            </MudRadio>
            @if (MaxPermissionLevel >= PermissionLevel.Owner)
            {
                <MudRadio Value="PermissionLevel.Owner" Color="Color.Secondary" Class="mt-2">
                    <MudStack Spacing="0">
                        <MudText Typo="Typo.body1">Owner</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">Full system access - Complete control over all settings, infrastructure, and user management</MudText>
                    </MudStack>
                </MudRadio>
            }
        </MudRadioGroup>

        @if (MaxPermissionLevel < PermissionLevel.Owner)
        {
            <MudAlert Severity="Severity.Info" Class="mt-4" Dense="true">
                You can only assign Admin or GlobalAdmin permissions.
            </MudAlert>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit">Save</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    IMudDialogInstance? MudDialog { get; set; }

    [Parameter]
    public PermissionLevel CurrentPermissionLevel { get; set; }

    [Parameter]
    public string UserEmail { get; set; } = string.Empty;

    /// <summary>
    /// Maximum permission level the current user can assign.
    /// GlobalAdmin can only assign Admin/GlobalAdmin, Owner can assign any level.
    /// </summary>
    [Parameter]
    public PermissionLevel MaxPermissionLevel { get; set; } = PermissionLevel.Owner; // Default to Owner for backward compatibility

    private PermissionLevel _selectedLevel;

    protected override void OnInitialized()
    {
        _selectedLevel = CurrentPermissionLevel;
    }

    private void Cancel()
    {
        MudDialog?.Cancel();
    }

    private void Submit()
    {
        MudDialog?.Close(DialogResult.Ok(_selectedLevel));
    }
}
