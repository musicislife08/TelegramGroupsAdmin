@using TelegramGroupsAdmin.Services
@using TelegramGroupsAdmin.Telegram.Models
@using TelegramGroupsAdmin.Models.Analytics
@using TelegramGroupsAdmin.Repositories
@using ApexCharts
@inject IMessageStatsService MessageStatsService
@inject IManagedChatsRepository ChatsRepository
@inject IAnalyticsRepository AnalyticsRepository
@inject IBlazorAuthHelper AuthHelper
@inject ISnackbar Snackbar
@inject IJSRuntime JsRuntime

<MudStack Spacing="4">
    @* Chat Filter *@
    @if (_accessibleChats.Any())
    {
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.subtitle2" Class="mb-2">Filter by Chat:</MudText>
            <MudChipSet SelectedValue="_selectedChatId"
                        SelectedValueChanged="OnChatSelectionChanged"
                        SelectionMode="SelectionMode.SingleSelection"
                        T="long">
                <MudChip Value="@(0L)" @key="0">All Chats</MudChip>
                @foreach (var chat in _accessibleChats)
                {
                    <MudChip Value="@chat.ChatId" @key="@chat.ChatId">@chat.ChatName</MudChip>
                }
            </MudChipSet>
        </MudPaper>
    }

    @* Date Range Selector *@
    <MudPaper Class="pa-4" Elevation="2">
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
            <MudText Typo="Typo.h6">Message Trends</MudText>
            <MudStack Row="true" Spacing="2">
                <MudButtonGroup Variant="Variant.Outlined" Color="MudBlazor.Color.Primary">
                    <MudButton OnClick="@LoadLast7Days">Last 7 Days</MudButton>
                    <MudButton OnClick="@LoadLast30Days">Last 30 Days</MudButton>
                    <MudButton OnClick="@LoadAllTime">All Time</MudButton>
                </MudButtonGroup>
                <MudButton Variant="Variant.Filled"
                          Color="MudBlazor.Color.Primary"
                          StartIcon="@Icons.Material.Filled.Refresh"
                          OnClick="@LoadData"
                          Disabled="@_loading">
                    Refresh
                </MudButton>
            </MudStack>
        </MudStack>

        @if (_startDate.HasValue && _endDate.HasValue)
        {
            <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary" Class="mt-2">
                Showing data from @_startDate.Value.ToString("MMM dd, yyyy") to @_endDate.Value.ToString("MMM dd, yyyy")
            </MudText>
        }
    </MudPaper>

    @if (_loading)
    {
        <MudProgressLinear Color="MudBlazor.Color.Primary" Indeterminate="true" />
    }

    @* Key Metrics Cards *@
    @if (_dataLoaded && _trendsData != null)
    {
        <MudGrid>
            <MudItem xs="12" md="3">
                <MudCard>
                    <MudCardContent>
                        <MudStack AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@Icons.Material.Filled.Message" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Primary" />
                            <MudText Typo="Typo.h3">@_trendsData.TotalMessages</MudText>
                            <MudText Typo="Typo.body1" Align="MudBlazor.Align.Center">Total Messages</MudText>
                            @if (_trendsData.WeekOverWeekGrowth?.HasPreviousPeriod == true)
                            {
                                <MudChip T="string" Size="MudBlazor.Size.Small" Color="@GetGrowthColor(_trendsData.WeekOverWeekGrowth.MessageGrowthPercent)" Variant="Variant.Text">
                                    @FormatGrowth(_trendsData.WeekOverWeekGrowth.MessageGrowthPercent)
                                </MudChip>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" md="3">
                <MudCard>
                    <MudCardContent>
                        <MudStack AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Success" />
                            <MudText Typo="Typo.h3">@_trendsData.DailyAverage.ToString("F0")</MudText>
                            <MudText Typo="Typo.body1" Align="MudBlazor.Align.Center">Daily Average</MudText>
                            @if (_trendsData.WeekOverWeekGrowth?.HasPreviousPeriod == true)
                            {
                                <MudChip T="string" Size="MudBlazor.Size.Small" Color="@GetGrowthColor(_trendsData.WeekOverWeekGrowth.MessageGrowthPercent)" Variant="Variant.Text">
                                    @FormatGrowth(_trendsData.WeekOverWeekGrowth.MessageGrowthPercent)
                                </MudChip>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" md="3">
                <MudCard>
                    <MudCardContent>
                        <MudStack AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@Icons.Material.Filled.People" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Info" />
                            <MudText Typo="Typo.h3">@_trendsData.UniqueUsers</MudText>
                            <MudText Typo="Typo.body1" Align="MudBlazor.Align.Center">Active Users</MudText>
                            @if (_trendsData.WeekOverWeekGrowth?.HasPreviousPeriod == true)
                            {
                                <MudChip T="string" Size="MudBlazor.Size.Small" Color="@GetGrowthColor(_trendsData.WeekOverWeekGrowth.UserGrowthPercent)" Variant="Variant.Text">
                                    @FormatGrowth(_trendsData.WeekOverWeekGrowth.UserGrowthPercent)
                                </MudChip>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" md="3">
                <MudCard>
                    <MudCardContent>
                        <MudStack AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@Icons.Material.Filled.Shield" Size="MudBlazor.Size.Large" Color="@(_trendsData.SpamPercentage > 5 ? MudBlazor.Color.Error : MudBlazor.Color.Success)" />
                            <MudText Typo="Typo.h3">@_trendsData.SpamPercentage.ToString("F1")%</MudText>
                            <MudText Typo="Typo.body1" Align="MudBlazor.Align.Center">Spam Rate</MudText>
                            @if (_trendsData.WeekOverWeekGrowth?.HasPreviousPeriod == true)
                            {
                                <MudChip T="string" Size="MudBlazor.Size.Small" Color="@GetGrowthColor(-_trendsData.WeekOverWeekGrowth.SpamGrowthPercent)" Variant="Variant.Text">
                                    @FormatGrowth(_trendsData.WeekOverWeekGrowth.SpamGrowthPercent)
                                </MudChip>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>

        @* New Metrics Cards (UX-2.1) *@
        <MudGrid Class="mt-2">
            @* Peak Activity Summary *@
            @if (_trendsData.PeakActivity != null)
            {
                <MudItem xs="12" md="4">
                    <MudCard Style="height: 100%">
                        <MudCardContent>
                            <MudStack AlignItems="AlignItems.Center" Spacing="2" Style="min-height: 160px" Justify="Justify.Center">
                                <MudIcon Icon="@Icons.Material.Filled.Schedule" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Info" />
                                <MudText Typo="Typo.h6" Align="MudBlazor.Align.Center">Peak Activity</MudText>
                                <MudText Typo="Typo.body2" Align="MudBlazor.Align.Center">@_trendsData.PeakActivity.PeakHourRange</MudText>
                                @if (_trendsData.PeakActivity.HasEnoughDataForWeekly && !string.IsNullOrEmpty(_trendsData.PeakActivity.PeakDayRange))
                                {
                                    <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary">@_trendsData.PeakActivity.PeakDayRange</MudText>
                                }
                            </MudStack>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }

            @* Spam Seasonality *@
            @if (_trendsData.SpamSeasonality != null)
            {
                <MudItem xs="12" md="4">
                    <MudCard Style="height: 100%">
                        <MudCardContent>
                            <MudStack Spacing="1" Style="min-height: 160px" Justify="Justify.Center">
                                <MudStack Row="true" Justify="Justify.Center" AlignItems="AlignItems.Center" Class="mb-2">
                                    <MudIcon Icon="@Icons.Material.Filled.Warning" Color="MudBlazor.Color.Warning" />
                                    <MudText Typo="Typo.h6">Peak Spam Patterns</MudText>
                                </MudStack>
                                <MudText Typo="Typo.body2" Align="MudBlazor.Align.Center"><strong>Daily:</strong> @_trendsData.SpamSeasonality.HourlyPattern</MudText>
                                @if (_trendsData.SpamSeasonality.HasWeeklyData && !string.IsNullOrEmpty(_trendsData.SpamSeasonality.WeeklyPattern))
                                {
                                    <MudText Typo="Typo.body2" Align="MudBlazor.Align.Center"><strong>Weekly:</strong> @_trendsData.SpamSeasonality.WeeklyPattern</MudText>
                                }
                                @if (_trendsData.SpamSeasonality.HasMonthlyData && !string.IsNullOrEmpty(_trendsData.SpamSeasonality.MonthlyPattern))
                                {
                                    <MudText Typo="Typo.body2" Align="MudBlazor.Align.Center"><strong>Yearly:</strong> @_trendsData.SpamSeasonality.MonthlyPattern</MudText>
                                }
                            </MudStack>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }

            @* Trusted User Breakdown *@
            @if (_trendsData.TrustedUserBreakdown != null)
            {
                <MudItem xs="12" md="4">
                    <MudCard Style="height: 100%">
                        <MudCardContent>
                            <MudStack AlignItems="AlignItems.Center" Spacing="2" Style="min-height: 160px" Justify="Justify.Center">
                                <MudIcon Icon="@Icons.Material.Filled.VerifiedUser" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Success" />
                                <MudText Typo="Typo.h6" Align="MudBlazor.Align.Center">Message Trust Level</MudText>
                                <MudText Typo="Typo.h4" Color="MudBlazor.Color.Success">@_trendsData.TrustedUserBreakdown.TrustedPercentage.ToString("F1")%</MudText>
                                <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary" Align="MudBlazor.Align.Center">
                                    @_trendsData.TrustedUserBreakdown.UntrustedPercentage.ToString("F1")% Untrusted, @_trendsData.TrustedUserBreakdown.AdminPercentage.ToString("F1")% Admins
                                </MudText>
                            </MudStack>
                        </MudCardContent>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>

        @* Daily Volume Chart *@
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">Daily Message Volume</MudText>
            @if (_dailyVolumeChart != null)
            {
                <ApexChart TItem="DailyVolumeData"
                          Title=""
                          Options="_dailyVolumeChart"
                          Height="250">
                    <ApexPointSeries TItem="DailyVolumeData"
                                    Items="_trendsData.DailyVolume"
                                    Name="Messages"
                                    SeriesType="SeriesType.Line"
                                    XValue="@(e => DateToUnixMs(e.Date))"
                                    YAggregate="@(e => e.Sum(x => x.Count))"
                                    OrderBy="e => e.X" />
                </ApexChart>
            }
        </MudPaper>

        @* Daily Active Users Chart (UX-2.1) *@
        @if (_trendsData.DailyActiveUsers.Any() && _dailyActiveUsersChart != null)
        {
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Daily Active Users</MudText>
                <ApexChart TItem="DailyActiveUsersData"
                          Title=""
                          Options="_dailyActiveUsersChart"
                          Height="250">
                    <ApexPointSeries TItem="DailyActiveUsersData"
                                    Items="_trendsData.DailyActiveUsers"
                                    Name="Active Users"
                                    SeriesType="SeriesType.Line"
                                    XValue="@(e => DateToUnixMs(e.Date))"
                                    YAggregate="@(e => e.Sum(x => x.UniqueUsers))"
                                    OrderBy="e => e.X" />
                </ApexChart>
            </MudPaper>
        }

        @* Clean Messages Chart (separate from spam for better visibility) *@
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">Daily Clean Messages</MudText>
            @if (_cleanMessagesChart != null)
            {
                <ApexChart TItem="DailyVolumeData"
                          Title=""
                          Options="_cleanMessagesChart"
                          Height="200">
                    <ApexPointSeries TItem="DailyVolumeData"
                                    Items="_trendsData.DailyHam"
                                    Name="Clean Messages"
                                    SeriesType="SeriesType.Area"
                                    XValue="@(e => DateToUnixMs(e.Date))"
                                    YAggregate="@(e => e.Sum(x => x.Count))"
                                    OrderBy="e => e.X" />
                </ApexChart>
            }
        </MudPaper>

        @* Spam Detections Chart (auto-scaled to show variation clearly) *@
        <MudPaper Class="pa-4" Elevation="2">
            <MudText Typo="Typo.h6" Class="mb-4">Daily Spam Detections</MudText>
            @if (_spamDetectionsChart != null)
            {
                <ApexChart TItem="DailyVolumeData"
                          Title=""
                          Options="_spamDetectionsChart"
                          Height="200">
                    <ApexPointSeries TItem="DailyVolumeData"
                                    Items="_trendsData.DailySpam"
                                    Name="Spam Detected"
                                    SeriesType="SeriesType.Area"
                                    XValue="@(e => DateToUnixMs(e.Date))"
                                    YAggregate="@(e => e.Sum(x => x.Count))"
                                    OrderBy="e => e.X" />
                </ApexChart>
            }
        </MudPaper>

        @* Spam Trend Comparison Cards *@
        @if (_spamTrendComparison != null)
        {
            <MudGrid>
                <TrendCard Data="_spamTrendComparison" Period="TrendPeriod.Week" />
                <TrendCard Data="_spamTrendComparison" Period="TrendPeriod.Month" />
                <TrendCard Data="_spamTrendComparison" Period="TrendPeriod.Year" />
            </MudGrid>
        }

        @* Top 5 Active Users (UX-2.1) *@
        @if (_trendsData.TopActiveUsers.Any())
        {
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Most Active Users</MudText>
                <MudTable Items="@_trendsData.TopActiveUsers" Dense="true" Hover="true" Elevation="0">
                    <HeaderContent>
                        <MudTh>Rank</MudTh>
                        <MudTh>User</MudTh>
                        <MudTh Style="text-align: right">Messages</MudTh>
                        <MudTh Style="text-align: right">Percentage</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        @{
                            var rank = _trendsData.TopActiveUsers.IndexOf(context) + 1;
                            var rankDisplay = rank switch
                            {
                                1 => "ðŸ¥‡",
                                2 => "ðŸ¥ˆ",
                                3 => "ðŸ¥‰",
                                _ => rank.ToString()
                            };
                        }
                        <MudTd DataLabel="Rank">@rankDisplay</MudTd>
                        <MudTd DataLabel="User">@context.DisplayName</MudTd>
                        <MudTd DataLabel="Messages" Style="text-align: right">@context.MessageCount</MudTd>
                        <MudTd DataLabel="Percentage" Style="text-align: right">@context.Percentage.ToString("F1")%</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        }

        @* Per-Chat Breakdown (only if multiple chats) *@
        @if (_trendsData.PerChatVolume.Count > 1)
        {
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Messages by Chat</MudText>
                @if (_perChatChart != null)
                {
                    <ApexChart TItem="ChatVolumeData"
                              Title=""
                              Options="_perChatChart"
                              Height="200">
                        <ApexPointSeries TItem="ChatVolumeData"
                                        Items="_trendsData.PerChatVolume"
                                        Name="Messages"
                                        SeriesType="SeriesType.Bar"
                                        XValue="@(e => e.ChatName)"
                                        YAggregate="@(e => e.Sum(x => x.Count))"
                                        OrderByDescending="e => e.Y" />
                    </ApexChart>
                }
            </MudPaper>
        }
    }
    else if (!_loading && !_dataLoaded)
    {
        <MudAlert Severity="Severity.Info">
            No message data available for the selected time range.
        </MudAlert>
    }
</MudStack>

@code {
    private bool _loading = true;
    private bool _dataLoaded;
    private DateTimeOffset? _startDate;
    private DateTimeOffset? _endDate;
    private string _userTimeZone = "UTC"; // Default to UTC until detected

    private List<ManagedChatRecord> _accessibleChats = [];
    private long _selectedChatId;

    private MessageTrendsData? _trendsData;
    private SpamTrendComparison? _spamTrendComparison;
    private ApexChartOptions<DailyVolumeData>? _dailyVolumeChart;
    private ApexChartOptions<DailyVolumeData>? _cleanMessagesChart;
    private ApexChartOptions<DailyVolumeData>? _spamDetectionsChart;
    private ApexChartOptions<ChatVolumeData>? _perChatChart;
    private ApexChartOptions<DailyActiveUsersData>? _dailyActiveUsersChart;

    // Helper to convert DateOnly to Unix timestamp (milliseconds) for ApexCharts
    private static long DateToUnixMs(DateOnly date) =>
        new DateTimeOffset(date.ToDateTime(TimeOnly.MinValue), TimeSpan.Zero).ToUnixTimeMilliseconds();

    // Helper to get color for growth indicators (UX-2.1)
    private static MudBlazor.Color GetGrowthColor(double growthPercent)
    {
        return growthPercent switch
        {
            > 0 => MudBlazor.Color.Success,
            < 0 => MudBlazor.Color.Error,
            _ => MudBlazor.Color.Default
        };
    }

    // Helper to format growth percentage with arrow (UX-2.1)
    private static string FormatGrowth(double growthPercent)
    {
        var arrow = growthPercent switch
        {
            > 0 => "â†‘",
            < 0 => "â†“",
            _ => "â†’"
        };
        return $"{arrow} {Math.Abs(growthPercent):F1}%";
    }

    private async Task OnChatSelectionChanged(long newChatId)
    {
        _selectedChatId = newChatId;
        await LoadData();
    }

    private List<long> GetSelectedChatIds()
    {
        // If "All" chip is selected (Value = 0 = global), return empty list (all accessible chats)
        if (_selectedChatId == 0L)
        {
            return [];
        }

        // Otherwise return the single selected chat ID as a list
        return [_selectedChatId];
    }

    protected override async Task OnInitializedAsync()
    {
        // Detect user's timezone from browser
        try
        {
            _userTimeZone = await JsRuntime.InvokeAsync<string>("getUserTimeZone");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Failed to detect timezone, using UTC: {ex.Message}");
            _userTimeZone = "UTC";
        }

        // Load accessible chats based on permissions
        var userId = await AuthHelper.GetCurrentUserIdAsync();
        var permissionLevel = await AuthHelper.GetCurrentPermissionLevelAsync();

        if (!string.IsNullOrEmpty(userId))
        {
            _accessibleChats = await ChatsRepository.GetUserAccessibleChatsAsync(
                userId,
                permissionLevel,
                cancellationToken: CancellationToken.None);
        }

        await LoadLast30Days();
    }

    private async Task LoadLast7Days()
    {
        _endDate = DateTimeOffset.UtcNow;
        _startDate = _endDate.Value.AddDays(-7);
        await LoadData();
    }

    private async Task LoadLast30Days()
    {
        _endDate = DateTimeOffset.UtcNow;
        _startDate = _endDate.Value.AddDays(-30);
        await LoadData();
    }

    private async Task LoadAllTime()
    {
        _endDate = DateTimeOffset.UtcNow;
        _startDate = DateTimeOffset.MinValue;
        await LoadData();
    }

    private async Task LoadData()
    {
        if (!_startDate.HasValue || !_endDate.HasValue)
            return;

        _loading = true;

        // Clear existing data to force chart re-render
        _trendsData = null;
        _spamTrendComparison = null;
        _dailyVolumeChart = null;
        _cleanMessagesChart = null;
        _spamDetectionsChart = null;
        _perChatChart = null;
        _dailyActiveUsersChart = null;
        StateHasChanged(); // Clear old charts first

        try
        {
            // Load message trends and spam trend comparison in parallel
            var trendsTask = MessageStatsService.GetMessageTrendsAsync(
                GetSelectedChatIds(),
                _startDate.Value,
                _endDate.Value,
                _userTimeZone,
                CancellationToken.None);

            var spamTrendsTask = AnalyticsRepository.GetSpamTrendComparisonAsync(
                _userTimeZone,
                CancellationToken.None);

            await Task.WhenAll(trendsTask, spamTrendsTask);

            _trendsData = await trendsTask;
            _spamTrendComparison = await spamTrendsTask;

            PrepareCharts();
            _dataLoaded = true;
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Failed to load trends data: {ex.Message}", Severity.Error);
        }
        finally
        {
            _loading = false;
        }
    }

    private void PrepareCharts()
    {
        if (_trendsData == null) return;

        // Daily volume chart
        _dailyVolumeChart = new ApexChartOptions<DailyVolumeData>
        {
            Chart = new Chart
            {
                Toolbar = new Toolbar { Show = false },
                Zoom = new Zoom { Enabled = false }
            },
            Stroke = new Stroke { Curve = Curve.Smooth, Width = 3 },
            Colors = ["#2196F3"],
            Xaxis = new XAxis
            {
                Type = XAxisType.Datetime,
                Labels = new XAxisLabels { Format = "MMM dd" }
            },
            Yaxis = [new YAxis { Title = new AxisTitle { Text = "Messages" } }]
        };

        // Clean messages chart (green, auto-scaled)
        _cleanMessagesChart = new ApexChartOptions<DailyVolumeData>
        {
            Chart = new Chart
            {
                Toolbar = new Toolbar { Show = false },
                Zoom = new Zoom { Enabled = false }
            },
            Stroke = new Stroke { Curve = Curve.Smooth, Width = 2 },
            Colors = ["#4CAF50"],
            Xaxis = new XAxis
            {
                Type = XAxisType.Datetime,
                Labels = new XAxisLabels { Format = "MMM dd" }
            },
            Yaxis = [new YAxis { Title = new AxisTitle { Text = "Clean Messages" } }],
            Fill = new Fill { Type = [FillType.Gradient] }
        };

        // Spam detections chart (red, auto-scaled independently for visibility)
        _spamDetectionsChart = new ApexChartOptions<DailyVolumeData>
        {
            Chart = new Chart
            {
                Toolbar = new Toolbar { Show = false },
                Zoom = new Zoom { Enabled = false }
            },
            Stroke = new Stroke { Curve = Curve.Smooth, Width = 2 },
            Colors = ["#F44336"],
            Xaxis = new XAxis
            {
                Type = XAxisType.Datetime,
                Labels = new XAxisLabels { Format = "MMM dd" }
            },
            Yaxis = [new YAxis { Title = new AxisTitle { Text = "Spam Detected" } }],
            Fill = new Fill { Type = [FillType.Gradient] }
        };

        // Per-chat chart
        _perChatChart = new ApexChartOptions<ChatVolumeData>
        {
            Chart = new Chart
            {
                Toolbar = new Toolbar { Show = false }
            },
            Colors = ["#2196F3"],
            PlotOptions = new PlotOptions
            {
                Bar = new PlotOptionsBar
                {
                    Horizontal = true
                }
            },
            Xaxis = new XAxis { Title = new AxisTitle { Text = "Messages" } },
            Yaxis = [new YAxis { Title = new AxisTitle { Text = "Chat" } }]
        };

        // Daily active users chart (UX-2.1)
        _dailyActiveUsersChart = new ApexChartOptions<DailyActiveUsersData>
        {
            Chart = new Chart
            {
                Toolbar = new Toolbar { Show = false },
                Zoom = new Zoom { Enabled = false }
            },
            Stroke = new Stroke { Curve = Curve.Smooth, Width = 3 },
            Colors = ["#9C27B0"],
            Xaxis = new XAxis
            {
                Type = XAxisType.Datetime,
                Labels = new XAxisLabels { Format = "MMM dd" }
            },
            Yaxis = [new YAxis { Title = new AxisTitle { Text = "Users" } }]
        };
    }

}
