name: Validate PR Target

# IMPORTANT: This workflow intentionally does NOT use paths-ignore.
# We enforce the develop ‚Üí master workflow for ALL PRs, regardless of
# file changes. Even documentation-only PRs must go through develop first.
# This ensures consistent workflow enforcement and prevents accidental
# feature ‚Üí master merges.

on:
  pull_request:
    branches:
      - master

jobs:
  validate-pr-source:
    name: Validate PR Source Branch
    runs-on: ubuntu-latest

    steps:
      - name: Check PR source branch
        env:
          SOURCE_BRANCH: ${{ github.head_ref }}
        run: |
          echo "üîç Validating PR source branch..."
          echo "Source branch: $SOURCE_BRANCH"
          echo "Target branch: master"
          echo ""

          # Only allow develop ‚Üí master PRs
          if [[ "$SOURCE_BRANCH" != "develop" ]]; then
            echo "‚ùå ERROR: Pull requests to master must come from 'develop' branch"
            echo ""
            echo "Current source: $SOURCE_BRANCH"
            echo "Required source: develop"
            echo ""
            echo "üìã Correct workflow:"
            echo "1. Create PR: $SOURCE_BRANCH ‚Üí develop"
            echo "2. Merge to develop after tests pass"
            echo "3. Then create PR: develop ‚Üí master"
            echo ""
            echo "This ensures all changes go through the develop branch for testing before reaching master."
            echo ""
            echo "üìñ See CLAUDE.md 'Git Workflow' section for full documentation"
            exit 1
          fi

          echo "‚úÖ PR source validation passed - develop ‚Üí master is allowed"
